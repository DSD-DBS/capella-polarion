# Copyright DB Netz AG and contributors
# SPDX-License-Identifier: Apache-2.0

variables:
  CAPELLA2POLARION_DEBUG: "1"

capella2polarion_synchronise_elements:
  needs:
    - job: update_capella_diagram_cache
      artifacts: true

  script:
    - pip install https://$PYPI_ARTIFACTORY_USERNAME:$PYPI_ARTIFACTORY_PASSWORD@$PYPI_ARTIFACTORY/polarion-rest-api-client/attachments/polarion_rest_api_client-attachments-py3-none-any.whl
    - pip install https://$PYPI_ARTIFACTORY_USERNAME:$PYPI_ARTIFACTORY_PASSWORD@$PYPI_ARTIFACTORY/capella2polarion/less-requests/capella2polarion-less_requests-py3-none-any.whl
    - >
      python \
        -m capella2polarion \
        $([[ $CAPELLA2POLARION_DEBUG -eq 1 ]] && echo '--debug') \
        --project-id=${CAPELLA2POLARION_PROJECT_ID:?} \
        model-elements \
        "${CAPELLA2POLARION_MODEL_JSON:?}" \
        ./diagram_cache \
        ${CAPELLA2POLARION_CONFIG:?}

  artifacts:
    paths:
      - elements_index.yaml
